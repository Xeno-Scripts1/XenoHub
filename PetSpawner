--// Xeno's Visual Pet Spawner (Backpack Pet Edition)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Backpack = LocalPlayer:WaitForChild("Backpack")

-- Clean old UI
if PlayerGui:FindFirstChild("XenoPetSpawnerUI") then
    PlayerGui.XenoPetSpawnerUI:Destroy()
end

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "XenoPetSpawnerUI"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = PlayerGui

-- Toggle hotkey (X)
screenGui.Enabled = true
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.X then
        screenGui.Enabled = not screenGui.Enabled
    end
end)

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,450,0,320)
mainFrame.Position = UDim2.new(0.5,-225,0.5,-160)
mainFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,12)
corner.Parent = mainFrame

-- Draggable
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    mainFrame.Position = UDim2.new(
        startPos.X.Scale, startPos.X.Offset + delta.X,
        startPos.Y.Scale, startPos.Y.Offset + delta.Y
    )
end

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
mainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then update(input) end
end)

-- Vibrant Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1,0,0,40)
titleBar.BackgroundColor3 = Color3.fromRGB(255,85,255)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(255,85,255)),
                                   ColorSequenceKeypoint.new(1, Color3.fromRGB(85,170,255))}
gradient.Rotation = 45
gradient.Parent = titleBar

local titleLabel = Instance.new("TextLabel")
titleLabel.Text = "🐾 Xeno's Pet Spawner"
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.TextSize = 20
titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
titleLabel.BackgroundTransparency = 1
titleLabel.Size = UDim2.new(1,0,1,0)
titleLabel.TextXAlignment = Enum.TextXAlignment.Center
titleLabel.Parent = titleBar

-- Close button
local closeButton = Instance.new("TextButton")
closeButton.Text = "❌"
closeButton.Font = Enum.Font.SourceSansBold
closeButton.TextSize = 18
closeButton.TextColor3 = Color3.new(1,1,1)
closeButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
closeButton.Size = UDim2.new(0,30,0,30)
closeButton.Position = UDim2.new(1,-35,0,5)
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(1,0)
closeCorner.Parent = closeButton

closeButton.MouseEnter:Connect(function()
    closeButton.BackgroundColor3 = Color3.fromRGB(200,50,50)
end)
closeButton.MouseLeave:Connect(function()
    closeButton.BackgroundColor3 = Color3.fromRGB(50,50,50)
end)
closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- TextBox creator with shadow effect
local function createBox(placeholderText, posX, posY, width)
    local shadow = Instance.new("Frame")
    shadow.Size = UDim2.new(0,width,0,35)
    shadow.Position = UDim2.new(0,posX+2,0,posY+2)
    shadow.BackgroundColor3 = Color3.fromRGB(20,20,20)
    shadow.BorderSizePixel = 0
    shadow.Parent = mainFrame
    local shadowCorner = Instance.new("UICorner")
    shadowCorner.CornerRadius = UDim.new(0,6)
    shadowCorner.Parent = shadow

    local box = Instance.new("TextBox")
    box.Size = UDim2.new(0,width,0,35)
    box.Position = UDim2.new(0,posX,0,posY)
    box.BackgroundColor3 = Color3.fromRGB(120,0,255)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.Font = Enum.Font.SourceSansBold
    box.TextSize = 16
    box.PlaceholderText = placeholderText
    box.ClearTextOnFocus = false
    box.Text = ""
    box.Parent = mainFrame
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0,6)
    corner.Parent = box
    return box
end

local petBox = createBox("Pet Name", 25, 60, 180)
local weightBox = createBox("Weight", 245, 60, 180)
local ageBox = createBox("Age", 25, 110, 400)

-- Loading bar
local loadingContainer = Instance.new("Frame")
loadingContainer.Size = UDim2.new(0.9,0,0,25)
loadingContainer.Position = UDim2.new(0.05,0,0,160)
loadingContainer.BackgroundColor3 = Color3.fromRGB(50,50,50)
loadingContainer.BorderSizePixel = 0
loadingContainer.Visible = false
loadingContainer.Parent = mainFrame

local loadingCorner = Instance.new("UICorner")
loadingCorner.CornerRadius = UDim.new(0,6)
loadingCorner.Parent = loadingContainer

local loadingBar = Instance.new("Frame")
loadingBar.Size = UDim2.new(0,0,1,0)
loadingBar.Position = UDim2.new(0,0,0,0)
loadingBar.BackgroundColor3 = Color3.fromRGB(255,0,255)
loadingBar.BorderSizePixel = 0
loadingBar.Parent = loadingContainer

local barCorner = Instance.new("UICorner")
barCorner.CornerRadius = UDim.new(0,6)
barCorner.Parent = loadingBar

local loadingPercent = Instance.new("TextLabel")
loadingPercent.Text = "0%"
loadingPercent.Font = Enum.Font.SourceSansBold
loadingPercent.TextSize = 16
loadingPercent.TextColor3 = Color3.fromRGB(255,255,255)
loadingPercent.BackgroundTransparency = 1
loadingPercent.Size = UDim2.new(1,0,1,0)
loadingPercent.Parent = loadingBar
loadingPercent.TextXAlignment = Enum.TextXAlignment.Center
loadingPercent.TextYAlignment = Enum.TextYAlignment.Center

-- Spawn Button
local spawnButton = Instance.new("TextButton")
spawnButton.Text = "SPAWN PET"
spawnButton.Font = Enum.Font.SourceSansBold
spawnButton.TextSize = 20
spawnButton.TextColor3 = Color3.fromRGB(255,255,255)
spawnButton.BackgroundColor3 = Color3.fromRGB(180,0,255)
spawnButton.Size = UDim2.new(0.9,0,0,40)
spawnButton.Position = UDim2.new(0.05,0,0,200)
spawnButton.Parent = mainFrame

local spawnCorner = Instance.new("UICorner")
spawnCorner.CornerRadius = UDim.new(0,8)
spawnCorner.Parent = spawnButton

-- Warning
local warningLabel = Instance.new("TextLabel")
warningLabel.Text = "⚠️ Do NOT leave the game during spawning, you may get banned!"
warningLabel.Font = Enum.Font.SourceSansBold
warningLabel.TextSize = 14
warningLabel.TextColor3 = Color3.fromRGB(255,255,0)
warningLabel.BackgroundTransparency = 1
warningLabel.Size = UDim2.new(0.9,0,0,30)
warningLabel.Position = UDim2.new(0.05,0,0,250)
warningLabel.TextWrapped = true
warningLabel.TextXAlignment = Enum.TextXAlignment.Center
warningLabel.Parent = mainFrame

-- Spawn function (Backpack Pet)
local function spawnVisualPet(petName, weight, age)
    local petsFolder = ReplicatedStorage:FindFirstChild("Pets")
    if not petsFolder then
        warn("No Pets folder in ReplicatedStorage")
        return
    end

    local petModel = petsFolder:FindFirstChild(petName)
    if not petModel then
        warn("Pet not found: "..petName)
        return
    end

    local clone = petModel:Clone()
    clone.Name = petName.." (Visual)"
    clone:SetAttribute("Weight", tonumber(weight) or 1)
    clone:SetAttribute("Age", tonumber(age) or 1)

    -- Create Tool
    local tool = Instance.new("Tool")
    tool.Name = clone.Name
    tool.RequiresHandle = true
    tool.CanBeDropped = true

    -- Create visible handle
    local handle = Instance.new("Part")
    handle.Name = "Handle"
    handle.Size = Vector3.new(2,2,2)
    handle.Transparency = 0 -- visible
    handle.CanCollide = false
    handle.Anchored = false
    handle.Parent = tool

    -- Position pet model relative to handle
    clone.PrimaryPart = clone:FindFirstChildWhichIsA("BasePart") or clone:FindFirstChild()
    if clone.PrimaryPart then
        clone:SetPrimaryPartCFrame(handle.CFrame)
    end
    clone.Parent = tool

    -- Weld all parts to handle
    for _, part in pairs(clone:GetDescendants()) do
        if part:IsA("BasePart") then
            part.Anchored = false
            part.CanCollide = false
            local weld = Instance.new("WeldConstraint")
            weld.Part0 = handle
            weld.Part1 = part
            weld.Parent = handle
        end
    end

    -- Parent tool to Backpack
    tool.Parent = Backpack

    -- Equip immediately
    task.delay(0.1, function()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character.Humanoid:EquipTool(tool)
        end
    end)

    -- Animate loading bar
    loadingContainer.Visible = true
    loadingBar.Size = UDim2.new(0,0,1,0)
    loadingPercent.Text = "0%"
    local duration = 2
    local startTime = tick()
    local conn
    conn = RunService.Heartbeat:Connect(function()
        local elapsed = tick() - startTime
        local pct = math.clamp(elapsed/duration,0,1)
        loadingBar.Size = UDim2.new(pct,0,1,0)
        loadingPercent.Text = math.floor(pct*100).."%"
        if pct >= 1 then
            loadingContainer.Visible = false
            conn:Disconnect()
        end
    end)
end

-- Spawn Button Logic
spawnButton.MouseButton1Click:Connect(function()
    local petName = petBox.Text
    local weight = weightBox.Text
    local age = ageBox.Text

    if petName == "" then
        warn("Please enter a pet name")
        return
    end

    spawnVisualPet(petName, weight, age)
end)
