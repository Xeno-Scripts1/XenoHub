local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- UI Setup
local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "EggRandomizerUI"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame", screenGui)
mainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
mainFrame.Size = UDim2.new(0, 310, 0, 270) -- a little taller for loading bar
mainFrame.Position = UDim2.new(0.5, -155, 0.3, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.BorderSizePixel = 0

local mainCorner = Instance.new("UICorner", mainFrame)
mainCorner.CornerRadius = UDim.new(0, 12)

-- Title Bar (only top corners rounded, bottom sharp)
local titleBar = Instance.new("TextLabel", mainFrame)
titleBar.Text = "‚ôªÔ∏è  ‚ôªÔ∏è  Xeno's Egg Randomizer  ‚ôªÔ∏è  ‚ôªÔ∏è"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
titleBar.TextColor3 = Color3.new(1, 1, 1)
titleBar.Font = Enum.Font.GothamBold
titleBar.TextSize = 16
titleBar.TextWrapped = true
titleBar.TextXAlignment = Enum.TextXAlignment.Center

local titleTopCorner = Instance.new("UICorner", titleBar)
titleTopCorner.CornerRadius = UDim.new(0, 10)

-- Exit Button
local exitButton = Instance.new("TextButton", mainFrame)
exitButton.Text = "‚ùé"
exitButton.Size = UDim2.new(0, 25, 0, 25)
exitButton.Position = UDim2.new(1, -30, 0, 2)
exitButton.BackgroundColor3 = Color3.fromRGB(110, 15, 15)
exitButton.TextColor3 = Color3.new(1, 1, 1)
exitButton.Font = Enum.Font.GothamBold
exitButton.TextSize = 14
exitButton.BorderSizePixel = 0
exitButton.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)

-- Auto Button (wider and closer to edges)
local autoButton = Instance.new("TextButton", mainFrame)
autoButton.Size = UDim2.new(1, -24, 0, 36)  -- wider, with 12px margin each side
autoButton.Position = UDim2.new(0, 12, 0, 40)
autoButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
autoButton.TextColor3 = Color3.new(1, 1, 1)
autoButton.Font = Enum.Font.GothamBold
autoButton.TextSize = 14
autoButton.Text = "üîÑ Auto Reroll: OFF"
autoButton.AutoButtonColor = false
autoButton.BorderSizePixel = 0

-- Manual Button (wider and closer to edges)
local manualButton = Instance.new("TextButton", mainFrame)
manualButton.Size = UDim2.new(1, -24, 0, 36)
manualButton.Position = UDim2.new(0, 12, 0, 85)
manualButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
manualButton.TextColor3 = Color3.new(1, 1, 1)
manualButton.Font = Enum.Font.GothamBold
manualButton.TextSize = 14
manualButton.Text = "üêæ Manual Reroll"
manualButton.AutoButtonColor = false
manualButton.BorderSizePixel = 0

-- Loading Bar Background (for reroll progress)
local loadingBarBG = Instance.new("Frame", mainFrame)
loadingBarBG.Size = UDim2.new(1, -24, 0, 20)
loadingBarBG.Position = UDim2.new(0, 12, 0, 130)
loadingBarBG.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
loadingBarBG.BorderSizePixel = 0
loadingBarBG.AnchorPoint = Vector2.new(0, 0)
local loadingBarCorner = Instance.new("UICorner", loadingBarBG)
loadingBarCorner.CornerRadius = UDim.new(0, 8)

-- Loading Bar Fill
local loadingBarFill = Instance.new("Frame", loadingBarBG)
loadingBarFill.Size = UDim2.new(0, 0, 1, 0)  -- width will be updated dynamically
loadingBarFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
loadingBarFill.BorderSizePixel = 0
local loadingFillCorner = Instance.new("UICorner", loadingBarFill)
loadingFillCorner.CornerRadius = UDim.new(0, 8)

-- Loading Bar Text
local loadingBarText = Instance.new("TextLabel", loadingBarBG)
loadingBarText.Size = UDim2.new(1, 0, 1, 0)
loadingBarText.BackgroundTransparency = 1
loadingBarText.TextColor3 = Color3.new(1, 1, 1)
loadingBarText.Font = Enum.Font.GothamBold
loadingBarText.TextSize = 14
loadingBarText.Text = ""
loadingBarText.TextXAlignment = Enum.TextXAlignment.Center
loadingBarText.TextYAlignment = Enum.TextYAlignment.Center

-- Warning Label (with space between lines)
local warning = Instance.new("TextLabel", mainFrame)
warning.Text = "‚ö†Ô∏è THIS SCRIPT IS SAFE TO USE\n\nüõ°Ô∏è ANTI STEALER ACTIVATED"
warning.Size = UDim2.new(1, -24, 0, 45)
warning.Position = UDim2.new(0, 12, 0, 160)
warning.BackgroundTransparency = 1
warning.TextColor3 = Color3.fromRGB(255, 180, 120)
warning.Font = Enum.Font.GothamBold
warning.TextSize = 14
warning.TextWrapped = true
warning.TextXAlignment = Enum.TextXAlignment.Center
warning.TextYAlignment = Enum.TextYAlignment.Top

-- Footer (only bottom corners rounded, top corners sharp)
local footer = Instance.new("TextLabel", mainFrame)
footer.Text = "üõ†Ô∏è Made by XenoScripts | Premium üõ†Ô∏è"
footer.Size = UDim2.new(1, 0, 0, 25)
footer.Position = UDim2.new(0, 0, 1, -25)
footer.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
footer.TextColor3 = Color3.new(1, 1, 1)
footer.Font = Enum.Font.Gotham
footer.TextSize = 13
footer.TextXAlignment = Enum.TextXAlignment.Center

local footerCorner = Instance.new("UICorner", footer)
footerCorner.CornerRadius = UDim.new(0, 10)
footerCorner.Parent = footer

-- Footer mask to keep top corners sharp
local footerMask = Instance.new("Frame", footer)
footerMask.BackgroundColor3 = footer.BackgroundColor3
footerMask.Size = UDim2.new(1, 0, 0.5, 0)
footerMask.Position = UDim2.new(0, 0, 0, 0)
footerMask.BorderSizePixel = 0

-- Egg Data
local eggChances = {
	["Common Egg"] = {["Dog"] = 33, ["Bunny"] = 33, ["Golden Lab"] = 33},
	["Uncommon Egg"] = {["Black Bunny"] = 25, ["Chicken"] = 25, ["Cat"] = 25, ["Deer"] = 25},
	["Rare Egg"] = {["Orange Tabby"] = 33.33, ["Spotted Deer"] = 25, ["Pig"] = 16.67, ["Rooster"] = 16.67, ["Monkey"] = 8.33},
	["Legendary Egg"] = {["Cow"] = 42.55, ["Silver Monkey"] = 42.55, ["Sea Otter"] = 10.64, ["Turtle"] = 2.13, ["Polar Bear"] = 2.13},
	["Dinosaur Egg"] = {["Raptor"] = 33, ["Triceratops"] = 33, ["T-Rex"] = 1, ["Stegosaurus"] = 33, ["Pterodactyl"] = 33, ["Brontosaurus"] = 33}
}

local goodPets = {}
for eggName, pets in pairs(eggChances) do
	if eggName == "Legendary Egg" or eggName == "Dinosaur Egg" then
		for petName in pairs(pets) do
			goodPets[petName] = true
		end
	end
end

local function weightedRandom(pool)
	local total = 0
	local pets = {}
	for pet, weight in pairs(pool) do
		total += weight
		table.insert(pets, {name = pet, weight = weight})
	end
	table.sort(pets, function(a,b) return a.name < b.name end)
	
	local roll = math.random() * total
	local cumulative = 0
	for _, petInfo in ipairs(pets) do
		cumulative += petInfo.weight
		if roll <= cumulative then
			return petInfo.name
		end
	end
	return pets[#pets].name -- fallback
end

local function createOrUpdateBillboard(egg, eggName, petName, color)
	local gui = egg:FindFirstChild("PetESP")
	if not gui then
		gui = Instance.new("BillboardGui")
		gui.Name = "PetESP"
		gui.AlwaysOnTop = true
		gui.Size = UDim2.new(0, 200, 0, 50)
		gui.StudsOffset = Vector3.new(0, 2.5, 0)
		gui.Adornee = egg:FindFirstChildWhichIsA("BasePart") or egg
		gui.Parent = egg
	end

	local label = gui:FindFirstChild("TextLabel")
	if not label then
		label = Instance.new("TextLabel", gui)
		label.Size = UDim2.new(1, 0, 1, 0)
		label.BackgroundTransparency = 1
		label.TextStrokeTransparency = 0.4
		label.TextScaled = true
		label.Font = Enum.Font.GothamBold
	end

	label.TextColor3 = color or Color3.new(1, 1, 1)
	label.Text = eggName .. " | " .. petName
end

local function findEggs()
	local eggs = {}
	for _, desc in ipairs(workspace:GetDescendants()) do
		if desc:IsA("Model") and desc.Name:match("Egg") and desc:FindFirstChildWhichIsA("BasePart") then
			local eggName = desc.Name
			if eggChances[eggName] then
				table.insert(eggs, {egg = desc, name = eggName})
			end
		end
	end
	return eggs
end

-- Alert Popup UI
local alertFrame = Instance.new("Frame", mainFrame)
alertFrame.BackgroundColor3 = Color3.fromRGB(255, 215, 0)
alertFrame.Size = UDim2.new(0.8, 0, 0, 40)
alertFrame.Position = UDim2.new(0.1, 0, 0, 220)
alertFrame.AnchorPoint = Vector2.new(0, 0)
alertFrame.Visible = false
alertFrame.ZIndex = 10
alertFrame.BorderSizePixel = 0

local alertCorner = Instance.new("UICorner", alertFrame)
alertCorner.CornerRadius = UDim.new(0, 10)

local alertText = Instance.new("TextLabel", alertFrame)
alertText.Size = UDim2.new(1, 0, 1, 0)
alertText.BackgroundTransparency = 1
alertText.TextColor3 = Color3.new(0, 0, 0)
alertText.Font = Enum.Font.GothamBold
alertText.TextSize = 18
alertText.Text = ""
alertText.TextStrokeTransparency = 0.5
alertText.TextWrapped = true
alertText.TextXAlignment = Enum.TextXAlignment.Center
alertText.TextYAlignment = Enum.TextYAlignment.Center

local function showAlert(message)
	alertText.Text = "üéâ‚ú® " .. message
	alertFrame.Visible = true
	task.delay(3, function()
		alertFrame.Visible = false
	end)
end

-- Auto Logic with loading bar
local autoReroll = false
local rerollCooldown = 3
local lastRerollTime = 0

autoButton.MouseButton1Click:Connect(function()
	autoReroll = not autoReroll
	if autoReroll then
		autoButton.Text = "üîÑ Auto Reroll: ON"
	else
		autoButton.Text = "üîÑ Auto Reroll: OFF"
		loadingBarFill.Size = UDim2.new(0, 0, 1, 0)
		loadingBarText.Text = ""
	end
end)

manualButton.MouseButton1Click:Connect(function()
	for _, info in ipairs(findEggs()) do
		local petName = weightedRandom(eggChances[info.name]) or "?"
		createOrUpdateBillboard(info.egg, info.name, petName)
		if goodPets[petName] then
			showAlert("You rolled a rare pet: "..petName.."!")
		end
	end
end)

RunService.RenderStepped:Connect(function(dt)
	local hue = (tick() * 0.1) % 1
	local color = Color3.fromHSV(hue, 1, 1)
	titleBar.TextColor3 = color

	if autoReroll then
		autoButton.BackgroundColor3 = color
	else
		autoButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	end

	for _, info in ipairs(findEggs()) do
		local gui = info.egg:FindFirstChild("PetESP")
		if gui and gui:FindFirstChild("TextLabel") then
			gui.TextLabel.TextColor3 = color
		end
	end
end)

task.spawn(function()
	while true do
		if autoReroll then
			local currentTime = tick()
			local elapsed = currentTime - lastRerollTime
			local progress = math.clamp(elapsed / rerollCooldown, 0, 1)

			loadingBarFill.Size = UDim2.new(progress, 0, 1, 0)
			loadingBarText.Text = ("Rerolling... %d%%"):format(progress * 100)

			if elapsed >= rerollCooldown then
				for _, info in ipairs(findEggs()) do
					local petName = weightedRandom(eggChances[info.name]) or "?"
					createOrUpdateBillboard(info.egg, info.name, petName)
					if goodPets[petName] then
						showAlert("You rolled a rare pet: "..petName.."!")
					end
				end
				lastRerollTime = currentTime
				loadingBarFill.Size = UDim2.new(0, 0, 1, 0)
				loadingBarText.Text = ""
			end
		else
			loadingBarFill.Size = UDim2.new(0, 0, 1, 0)
			loadingBarText.Text = ""
			lastRerollTime = tick()
		end
		task.wait(0.1)
	end
end)
